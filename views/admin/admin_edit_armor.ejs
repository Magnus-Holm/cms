<% include admin-partials/admin_head.ejs %>
<% include admin-partials/headerAdmin.ejs %>
<main role="main">
	<% include admin-partials/navAdmin.ejs %>
	<section>
		<form class="patchForm">
			<input type="hidden" name="id" value="<%= result.id %>">

			<label for="name">Item Navn</label>
			<input type="text" id="name" name="name" value="<%= result.name %>">

			<label for="picture">Picture</label>
			<input type="file" id="picture" name="picture">

			<img class="itemImg" src="/images/<%= result.picture %>" alt="">

			<label for="physical">Physical Defense</label>
			<input type="text" id="physical" name="physical" value="<%= result.defense_physical %>">


			<label for="elemental">Elemental Defense</label>
			<input type="text" id="elemental" name="elemental" value="<%= result.defense_elemental %>">

			<label for="resistance">Resistance</label>
			<input type="text" id="resistance" name="resistance" value="<%= result.resistance %>">


			<label for="poise">Poise</label>
			<input type="text" id="poise" name="poise" value="<%= result.poise %>">


			<label for="durability">Durability</label>
			<input type="text" id="durability" name="durability" value="<%= result.durability %>">


			<label for="weight">Weight</label>
			<input type="text" id="weight" name="weight" value="<%= result.weight %>">


			<label for="type">Armor Slot</label>
			<select name="type" id="type">
				<% armor_slot.forEach(type => { %>
				<option value="<%= type.id %>" <% if (result.armor_slot==type.id ){%> selected
					<%} %>>
					<%= type.slot_name %>
				</option>
				<% }); %>
			</select>

			<label for="notes">Notes</label>
			<textarea name="notes" id="notes" cols="30" rows="10"><%= result.notes %></textarea>

			<button type="submit">Update</button>
		</form>
	</section>
</main>
<script>
	const form = document.querySelector('.patchForm');
	form.addEventListener('submit', function (event) {
		event.preventDefault();
		fetch(`/admin/armor/edit/${this.id.value}`, {
				method: 'PATCH',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify({
					name: form.name.value,
					picture: form.picture.value,
					physical: form.physical.value,
					elemental: form.elemental.value,
					resistance: form.resistance.value,
					poise: form.poise.value,
					durability: form.durability.value,
					weight: form.weight.value,
					type: form.type.value,
					notes: form.notes.value
				})
			})
			.then(response => {
				if (response.status === 200) {
					window.location.href = '/admin/armor';
				}
			});
	});
</script>
</body>

</html>